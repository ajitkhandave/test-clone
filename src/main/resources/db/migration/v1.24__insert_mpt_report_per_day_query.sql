update `reports_query_details` set `query_detail`='SELECT DATE(po.order_date) AS order_date ,CASE WHEN ( TRIM(pv.print_vendor) ) IS NULL THEN '''' ELSE TRIM(pv.print_vendor) END AS print_vendor ,COUNT(DISTINCT po.id) AS order_count ,COUNT(DISTINCT (CASE WHEN LOWER(li.customer_product_id) LIKE ''%kit%'' THEN li.id END)) AS kit_count ,SUM(CAST((CASE WHEN (SELECT value FROM ${schema}.destination_property WHERE destination_id = d.id AND name = ''quantityOrdered'') IS NULL THEN lic.quantity ELSE (SELECT value FROM ${schema}.destination_property WHERE destination_id = d.id AND name = ''quantityOrdered'') END) AS UNSIGNED)) AS quantity ,COUNT(DISTINCT (SELECT TRIM(message) FROM ${schema}.tracking_status WHERE LEFT(TRIM(message),2) = ''1Z'' AND destination_id = d.id GROUP BY destination_id)) AS shipments FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id JOIN ${schema}.destination d ON d.line_item_id = li.id LEFT JOIN ${schema}.print_vendor pv ON pv.id = li.print_vendor WHERE po.program_id = 3 GROUP BY DATE(po.order_date) ,CASE WHEN ( TRIM(pv.print_vendor) ) IS NULL THEN '''' ELSE TRIM(pv.print_vendor) END' , `datasource` = '${schema}', `created_date` = NOW(), `modified_date` = NOW()
where report_id = (SELECT report_id from reports_details where report_name = 'MPT_REPORT_ORDER_COUNTS_PER_DAY')

update `reports_query_details` set `query_detail`='SELECT (SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''p3OrderId'') AS p3order_id ,po.client_order_id ,DATE(po.order_date) AS order_date ,DATE(po.order_need_by_date) AS order_need_by_date ,(SELECT DATE(modified_date) FROM ${schema}.order_status WHERE order_id = po.id AND status LIKE ''%SHIPPED%'' GROUP BY order_id) AS complete_ship_date ,(SELECT status FROM ${schema}.order_status WHERE id = po.order_status_id) AS order_status ,SUBSTRING_INDEX(SUBSTRING_INDEX((SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''artworkFileLocation''),''/'',6),''/'',-1) AS print_vendor ,COUNT(DISTINCT CONCAT(IFNULL(a.address1,''''), IFNULL(a.address2,''''), IFNULL(a.address3,''''), IFNULL(a.city,''''), IFNULL(a.state,''''), IFNULL(a.zip_code,''''), IFNULL(a.country,''''))) AS shipments FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id JOIN ${schema}.destination d ON li.id = d.line_item_id JOIN ${schema}.address a ON d.address_id = a.id WHERE po.program_id = 3 AND SUBSTRING_INDEX(SUBSTRING_INDEX((SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''artworkFileLocation''),''/'',6),''/'',-1) != ''RR-DO-11'' GROUP BY po.client_order_id ' , `datasource` = '${schema}', `created_date` = NOW(), `modified_date` = NOW()
where report_id = (SELECT report_id from reports_details where report_name = 'SHIPMENT BY ORDERS REPORT')

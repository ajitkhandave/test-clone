update `reports_query_details` set `query_detail`='SELECT UUID() as uuid, po.client_order_id ,DATE(po.order_date) as order_date,po.order_need_by_date ,po.id AS po_id ,(SELECT DATE(modified_date) FROM ${schema}.order_status WHERE order_id = po.id AND status = ''SENT_TO_PRINTER'' GROUP BY order_id) AS sent_to_print_date ,li.customer_product_id ,(CASE WHEN li.customer_product_id LIKE ''%kit%'' THEN ''Kit'' END) AS kit_y_n ,li.id AS li_id ,(SELECT status FROM ${schema}.line_item_status WHERE id = li.line_item_status_id) AS status ,lic.id AS lic_id ,lic.component_number ,lic.customer_sku ,CAST((CASE WHEN (SELECT value FROM ${schema}.destination_property WHERE destination_id = d.id AND name = ''quantityOrdered'') IS NULL THEN lic.quantity ELSE (SELECT value FROM ${schema}.destination_property WHERE destination_id = d.id AND name = ''quantityOrdered'') END) AS UNSIGNED) AS lic_quantity ,pv.print_vendor ,(SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''p3Segment'') AS p3Segment ,(SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''userName'') AS user_name ,@trim_sku\\:=LEFT(lic.customer_sku,LOCATE(''.'',lic.customer_sku)-1) AS trim_sku ,@productName\\:=(SELECT value FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') AS product_name ,@productType\\:=(SELECT value FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productType'') AS product_type ,@lowerproductName\\:=(SELECT LOWER(value) FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') AS lower_product_name ,@lowerproductType\\:=(SELECT LOWER(value) FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productType'') AS lower_product_type ,@oecb_identifier\\:=(CASE WHEN (lic.customer_sku LIKE ''MT-1021355%'' OR lic.customer_sku LIKE ''9183516%'' OR lic.customer_sku LIKE ''9201633%'') THEN 1 ELSE 0 END) AS oecb_identifier ,@placemat_identifier\\:=(CASE WHEN (lic.customer_sku LIKE ''9144528%'' OR lic.customer_sku LIKE ''MT-1170047%'') THEN 1 ELSE 0 END) AS placemat_identifier ,@bensum_identifier\\:=(CASE WHEN lic.customer_sku IN (''2017001'',''2017002'') THEN 1 ELSE 0 END) AS bensum_identifier ,@allsaver_identifier\\:=(CASE WHEN lic.customer_sku = ''3017001'' THEN 1 ELSE 0 END) AS allsaver_identifier ,@benatglace_identifier\\:=(CASE WHEN lic.customer_sku = ''4017001'' THEN 1 ELSE 0 END) AS benatglace_identifier ,@sbc_identifier\\:=(CASE WHEN lic.customer_sku = ''2017003'' THEN 1 ELSE 0 END) AS sbc_identifier ,@oestaticbrochure_identifier\\:=(CASE WHEN (lic.customer_sku LIKE ''EI2090401%'' OR lic.customer_sku LIKE ''EI20295463%'') THEN 1 ELSE 0 END) AS oe_static_brochure_identifier ,@kit_identifier\\:=(CASE WHEN LOWER(li.customer_product_id) LIKE ''%kit%'' THEN 1 ELSE 0 END) as kit_identifier ,(CASE WHEN (lic.customer_sku = ''MT-1021355.0'' OR lic.customer_sku = ''MT-1021355.1'') THEN ''Medical'' WHEN (lic.customer_sku LIKE ''9201633%'' OR lic.customer_sku = ''MT-1021355.3'') THEN ''Financial Protection'' WHEN (lic.customer_sku LIKE ''9183516%'' OR lic.customer_sku = ''MT-1021355.2'') THEN RIGHT((SELECT value FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND (NAME = ''TEMPLATEProduct_Type'' OR NAME = ''TEMPLATE_Product_Type'')),6) END) AS oecb_template ,@envelope_identifier\\:=(CASE WHEN @lowerproductName LIKE ''%envelope%'' THEN 1 ELSE 0 END) AS envelope_identifier ,@folder_identifier\\:=(CASE WHEN @lowerproductName LIKE ''%folder%'' THEN 1 ELSE 0 END) AS folder_identifier ,@flier_identifier\\:=(CASE WHEN @lowerproductType = ''static'' AND @envelope_identifier = 0 AND @folder_identifier = 0 AND @placemat_identifier = 0 THEN 1 END) AS flier_identifier ,(SELECT TRIM(message) FROM ${schema}.tracking_status WHERE LEFT(TRIM(message),2) = ''1Z'' AND destination_id = d.id GROUP BY destination_id) AS tracking_number FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id JOIN ${schema}.destination d ON d.line_item_id = li.id LEFT JOIN ${schema}.print_vendor pv ON pv.id = li.print_vendor WHERE po.program_id = 3' , `datasource` = '${schema}.', `created_date` = NOW(), `modified_date` = NOW()
where report_id = (SELECT report_id from reports_details where report_name = 'MPT REPORTS DATA')

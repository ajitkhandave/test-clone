INSERT INTO `reports_details` ( `report_name`, `created_by`, `created_date`, `modified_by`, `modified_date`) VALUES ('INVOICING PRICING ERROR REPORT', 'admin', NOW(), 'admin',NOW());

INSERT INTO `reports_query_details` (`report_id`) SELECT report_id from reports_details where report_name = 'INVOICING PRICING ERROR REPORT';

update `reports_query_details` set `query_detail`='SELECT b.customer_sku ,b.size ,b.black_color ,b.finish ,b.page_count ,COUNT(*) AS occurances FROM ( SELECT a.customer_sku ,esi.size ,esi.black_or_color AS black_color ,CAST((CASE WHEN (CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END) IS NULL THEN NULL WHEN (CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END) < 8 THEN ''Loose'' WHEN (CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END) < 48 THEN ''Saddle Stitch'' ELSE ''Perfect'' END) AS CHAR(50)) AS finish ,(CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END) AS page_count ,(CASE WHEN (CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END) < 8 THEN (CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END) WHEN (CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END) < 48 THEN CEILING((CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END)/4)*4 ELSE CEILING((CASE WHEN esi.is_static = 1 THEN esi.page_count ELSE a.lic_page_count END)/8)*8 END) AS page_count_config_join FROM ( SELECT lic.customer_sku ,lic.page_count AS lic_page_count ,(SELECT value FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') AS productName FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id WHERE po.program_id = 3 AND SUBSTRING_INDEX(SUBSTRING_INDEX((SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''artworkFileLocation''),''/'',6),''/'',-1) != ''RR-DO-11'' AND po.order_date >= ''2020-01-01'' ) a LEFT JOIN EnI.sku_item esi ON esi.item_number = a.customer_sku WHERE LOCATE(''envelope'',LOWER(a.productName)) = 0 AND LOCATE(''folder'',LOWER(a.productName)) = 0 ) b LEFT JOIN ${schema}.eni_pricing ep ON ep.size = b.size AND ep.finish = b.finish AND ep.page_count = b.page_count_config_join AND ep.black_color = b.black_color WHERE b.page_count > 0 AND b.customer_sku != ''UHEX15HM3673209'' AND (ep.sfly_config_price IS NULL OR ep.dl_config_price IS NULL OR ep.otp_config_price IS NULL OR ep.sw_config_price IS NULL) GROUP BY b.customer_sku ,b.size ,b.black_color ,b.finish ,b.page_count' , `datasource` = '${schema}', `created_date` = NOW(), `modified_date` = NOW()
where report_id = (SELECT report_id from reports_details where report_name = 'INVOICING PRICING ERROR REPORT')
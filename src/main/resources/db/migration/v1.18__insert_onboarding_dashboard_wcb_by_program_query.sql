update `reports_query_details` set `query_detail`='SELECT count(distinct a.order_id) AS orders_count, a.order_date, a.title, a.value2, SUM(a.quantity) as quantity FROM ( SELECT b.po_id as order_id, b.order_date as order_date, b.quantity , REPLACE((CASE WHEN LEFT(liccp.value,5) = ''https'' THEN REPLACE(SUBSTRING_INDEX(liccp.value,''/'',-1),''.jpg'','''') ELSE SUBSTRING_INDEX(liccp.value,''_'',-1) END),''%20'',''_'') AS value2 , (CASE WHEN liccp.name = ''TEMPLATE_Cover_Image'' THEN ''Cover'' WHEN liccp.name = ''TEMPLATE_DS_Mod_1'' THEN ''Decision Support'' WHEN liccp.name = ''TEMPLATE_DS_Mod_2'' THEN ''Decision Support'' WHEN liccp.name = ''TEMPLATE_DS_Mod_3'' THEN ''Decision Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_1'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_2'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_3'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_4'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_5'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_6'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_7'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_8'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_ES_Mod_9'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATE_HW_Mod_1'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATE_HW_Mod_2'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATE_HW_Mod_3'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATE_HW_Mod_4'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATE_HW_Mod_5'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATE_Optum_Rx'' THEN ''Pharmacy Selected'' WHEN liccp.name = ''TEMPLATE_WH_Mod_1'' THEN ''Womens Health'' WHEN liccp.name = ''TEMPLATE_WH_Mod_2'' THEN ''Womens Health'' WHEN liccp.name = ''TEMPLATECover_Image'' THEN ''Cover'' WHEN liccp.name = ''TEMPLATEDS_Mod_1'' THEN ''Decision Support'' WHEN liccp.name = ''TEMPLATEDS_Mod_2'' THEN ''Decision Support'' WHEN liccp.name = ''TEMPLATEDS_Mod_3'' THEN ''Decision Support'' WHEN liccp.name = ''TEMPLATEES_Mod_1'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEES_Mod_2'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEES_Mod_3'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEES_Mod_4'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEES_Mod_5'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEES_Mod_6'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEES_Mod_7'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEES_Mod_8'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEES_Mod_9'' THEN ''Extra Care Support'' WHEN liccp.name = ''TEMPLATEHW_Mod_1'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATEHW_Mod_2'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATEHW_Mod_3'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATEHW_Mod_4'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATEHW_Mod_5'' THEN ''Health And Wellness'' WHEN liccp.name = ''TEMPLATEOptum_Rx'' THEN ''Pharmacy Selected'' WHEN liccp.name = ''TEMPLATEWH_Mod_1'' THEN ''Womens Health'' WHEN liccp.name = ''TEMPLATEWH_Mod_2'' THEN ''Womens Health'' WHEN liccp.name = ''TEMPLATESP_MOD_01'' THEN ''Support for Parents'' WHEN liccp.name = ''TEMPLATESP_MOD_02'' THEN ''Support for Parents'' WHEN liccp.name = ''TEMPLATEPlan_Type'' THEN ''Plan Type'' WHEN liccp.name = ''TEMPLATEPercentage_Question'' THEN ''Percentage Question'' WHEN liccp.name = ''TEMPLATEDental'' THEN ''Dental'' WHEN liccp.name = ''TEMPLATEVision'' THEN ''Vision'' WHEN liccp.name = ''TEMPLATEVirtual_Visits'' THEN ''Virtual Visits'' WHEN liccp.name = ''TEMPLATEConvenience_Care'' THEN ''Convenience Care'' WHEN liccp.name = ''TEMPLATEBrochure_Version'' THEN ''Brochure Version'' END ) AS title FROM ( SELECT po.id AS po_id, DATE(po.order_date) as order_date ,lic.id AS lic_id ,lic.quantity FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id WHERE po.program_id = 3 AND li.customer_product_id LIKE ''%Welcome%'' AND li.customer_product_id LIKE ''%Configurable%'' AND (SELECT status FROM ${schema}.order_status WHERE id = po.order_status_id) IN (''ORDER_APPROVED'',''FAILED_SENT_TO_PRINTER'',''IN_PROCESS'',''SENT_TO_PRINTER'',''SHIPPED'') ) b JOIN ${schema}.line_item_component_custom_property liccp ON b.lic_id = liccp.line_item_component_id WHERE ( liccp.value != '''' OR liccp.name IN ( ''TEMPLATE_Cover_Image'', ''TEMPLATECover_Image'' ) ) AND liccp.name IN ( ''TEMPLATE_Cover_Image'', ''TEMPLATE_DS_Mod_1'', ''TEMPLATE_DS_Mod_2'', ''TEMPLATE_DS_Mod_3'', ''TEMPLATE_ES_Mod_1'', ''TEMPLATE_ES_Mod_2'', ''TEMPLATE_ES_Mod_3'', ''TEMPLATE_ES_Mod_4'', ''TEMPLATE_ES_Mod_5'', ''TEMPLATE_ES_Mod_6'', ''TEMPLATE_ES_Mod_7'', ''TEMPLATE_ES_Mod_8'', ''TEMPLATE_ES_Mod_9'', ''TEMPLATE_HW_Mod_1'', ''TEMPLATE_HW_Mod_2'', ''TEMPLATE_HW_Mod_3'', ''TEMPLATE_HW_Mod_4'', ''TEMPLATE_HW_Mod_5'', ''TEMPLATE_Optum_Rx'', ''TEMPLATE_WH_Mod_1'', ''TEMPLATE_WH_Mod_2'', ''TEMPLATECover_Image'', ''TEMPLATECompany_Name'', ''TEMPLATEDS_Mod_1'', ''TEMPLATEDS_Mod_2'', ''TEMPLATEDS_Mod_3'', ''TEMPLATEES_Mod_1'', ''TEMPLATEES_Mod_2'', ''TEMPLATEES_Mod_3'', ''TEMPLATEES_Mod_4'', ''TEMPLATEES_Mod_5'', ''TEMPLATEES_Mod_6'', ''TEMPLATEES_Mod_7'', ''TEMPLATEES_Mod_8'', ''TEMPLATEES_Mod_9'', ''TEMPLATEHW_Mod_1'', ''TEMPLATEHW_Mod_2'', ''TEMPLATEHW_Mod_3'', ''TEMPLATEHW_Mod_4'', ''TEMPLATEHW_Mod_5'', ''TEMPLATEOptum_Rx'', ''TEMPLATEWH_Mod_1'', ''TEMPLATEWH_Mod_2'', ''TEMPLATEPlan_Type'', ''TEMPLATEPercentage_Question'', ''TEMPLATEDental'', ''TEMPLATEVision'', ''TEMPLATEVirtual_Visits'', ''TEMPLATEConvenience_Care'', ''TEMPLATESP_MOD_01'', ''TEMPLATESP_Mod_02'', ''TEMPLATEBrochure_Version'' ) ) a WHERE a.title IS NOT NULL GROUP BY a.order_date, a.title, a.value2' , `datasource` = '${schema}', `created_date` = NOW(), `modified_date` = NOW()
where report_id = (SELECT report_id from reports_details where report_name = 'ONBOARDING DASHBOARD WCB BY PROGRAM REPORT')

INSERT INTO `reports_details` ( `report_name`, `created_by`, `created_date`, `modified_by`, `modified_date`) VALUES ('INVOICING ITEM COUNT KIT REPORT', 'admin', NOW(), 'admin',NOW());

INSERT INTO `reports_query_details` (`report_id`) SELECT report_id from reports_details where report_name = 'INVOICING ITEM COUNT KIT REPORT';

update `reports_query_details` set `query_detail`='SELECT UUID() as uuid, (SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''p3OrderId'') AS ''p3_order_id'' ,po.client_order_id ,DATE(po.order_date) AS order_date ,DATE(po.order_need_by_date) AS order_need_by_date ,(SELECT DATE(modified_date) FROM ${schema}.order_status WHERE order_id = po.id AND status LIKE ''%SHIPPED%'' GROUP BY order_id) AS complete_ship_date ,COUNT(DISTINCT lic.id) AS items_in_kit FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id JOIN ${schema}.destination d ON li.id = d.line_item_id WHERE po.program_id = 3 AND SUBSTRING_INDEX(SUBSTRING_INDEX((SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''artworkFileLocation''),''/'',6),''/'',-1) != ''RR-DO-11'' AND ( (SELECT DATE(modified_date) FROM ${schema}.line_item_status WHERE line_item_id = li.id AND status LIKE ''%SHIPPED%'' GROUP BY line_item_id) AND (SELECT DATE(modified_date) FROM ${schema}.line_item_status WHERE line_item_id = li.id AND status LIKE ''%SHIPPED%'' GROUP BY line_item_id) OR ((SELECT status FROM ${schema}.line_item_status WHERE id = li.line_item_status_id) NOT LIKE ''%SHIPPED%'' AND LEFT((SELECT TRIM(message) FROM ${schema}.tracking_status WHERE LEFT(TRIM(message),2) = ''1Z'' AND destination_id = d.id GROUP BY destination_id),2) = ''1Z'') ) AND LOCATE(''toolkit'',LOWER(customer_product_id)) = 0 AND ( LOCATE(''kit'',LOWER(customer_product_id)) > 0 OR LOCATE(''packet'',LOWER(customer_product_id)) > 0 OR customer_product_id = ''PA and DE Traditional'' ) GROUP BY li.id' , `datasource` = '${schema}', `created_date` = NOW(), `modified_date` = NOW()
where report_id = (SELECT report_id from reports_details where report_name = 'INVOICING ITEM COUNT KIT REPORT')
update `reports_query_details` set `query_detail`='SELECT po.id AS Platform_Order_ID, po.client_order_id AS Client_Order_ID, po.order_need_by_date AS Need_By_Date, po.order_date AS Order_Date, pc.status AS order_status, pc.modified_date AS last_modified_date, ( SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''userName'' ) AS Customer_Name, SUBSTRING_INDEX( SUBSTRING_INDEX( ( SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''artworkFileLocation'' ), ''/'', 6 ), ''/'', -1 ) AS Print_Vendor , li.customer_product_id AS Customer_Product_ID, d.id AS Destination_ID, d.organization_name AS Ship_To_Company_Name, a.id AS Address_ID, a.address1 AS Address1, a.address2 AS Address2, a.address3 AS Address3, a.city AS City, a.state AS State, ( CASE WHEN a.zip_code IS NULL THEN LEFT(a.postal_code, 5) ELSE a.zip_code END ) AS Zip_Code , oim.sbs_order_id AS SBS_Order_Id FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.destination d ON li.id = d.line_item_id JOIN ${schema}.address a ON d.address_id = a.id JOIN EnI.platform_correlation pc ON po.id = pc.platform_order_id AND pc.destination_id = d.id JOIN ${schema}.order_id_map oim ON oim.correlation_id = pc.correlation_id WHERE po.program_id = 3 AND pc.status IN (''ERROR'',''IN_PROCESS'',''PARTIAL_SHIPPED'',''SENT_TO_PRINTER'') AND DATE_ADD(pc.modified_date, INTERVAL 48 HOUR) <= NOW() AND pc.created_date >= ''2019-08-01''' , `datasource` = '${schema}', `created_date` = NOW(), `modified_date` = NOW()
where report_id = (SELECT report_id from reports_details where report_name = 'STATUS ALERT REPORT')

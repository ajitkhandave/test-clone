update `reports_query_details` set `query_detail`='( SELECT (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) as ship_date ,(CASE WHEN (lic.customer_sku LIKE ''MT-1021355%'' OR lic.customer_sku LIKE ''9183516%'' OR lic.customer_sku LIKE ''9201633%'') THEN ''OECB'' WHEN (lic.customer_sku LIKE ''9144528%'' OR lic.customer_sku LIKE ''MT-1170047%'') THEN ''Placemat'' WHEN lic.customer_sku IN (''2017001'',''2017002'') THEN ''Benefit Summary'' WHEN lic.customer_sku = ''3017001'' THEN ''All Savers-Plan Highlights'' WHEN lic.customer_sku = ''4017001'' THEN ''Benefits At A Glance'' WHEN lic.customer_sku = ''2017003'' THEN ''Summary of Benefits (SBC)'' WHEN (lic.customer_sku LIKE ''EI2090401%'' OR lic.customer_sku LIKE ''EI20295463%'') THEN ''OE Static Brochure'' WHEN (SELECT value FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productType'') = ''Static'' THEN (CASE WHEN (SELECT LOWER(value) FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') LIKE ''%envelope%'' THEN ''Envelope'' WHEN (SELECT LOWER(value) FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') LIKE ''%folder%'' THEN ''Folder'' ELSE ''Flyer'' END) END) AS product_segment ,(SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''p3Segment'') AS p3Segment ,(CASE WHEN lic.customer_sku IN (''MT-1021355.0'',''MT-1021355.1'') THEN ''Medical'' WHEN (lic.customer_sku LIKE ''9201633%'' OR lic.customer_sku = ''MT-1021355.3'') THEN ''Financial Protection'' WHEN (lic.customer_sku LIKE ''9183516%'' OR lic.customer_sku = ''MT-1021355.2'') THEN RIGHT((SELECT value FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND (NAME = ''TEMPLATEProduct_Type'' OR NAME = ''TEMPLATE_Product_Type'')),6) END) AS oecb_template ,SUM(lic.quantity) AS quantity ,COUNT(DISTINCT po.id) AS orders ,0 AS people FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id LEFT JOIN eni.sku_item esi ON esi.item_number = lic.customer_sku WHERE po.program_id = 3 AND (li.customer_product_id LIKE ''%Open Enrollment%'' OR li.customer_product_id LIKE ''%OE %'') AND YEAR(po.order_date) >= YEAR(CURDATE()) - 1 AND (SELECT status FROM ${schema}.order_status WHERE id = po.order_status_id) IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'') AND (SELECT LOWER(value) FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') NOT LIKE ''%envelope%'' AND (SELECT LOWER(value) FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') NOT LIKE ''%folder%'' GROUP BY (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) ,(CASE WHEN (lic.customer_sku LIKE ''MT-1021355%'' OR lic.customer_sku LIKE ''9183516%'' OR lic.customer_sku LIKE ''9201633%'') THEN ''OECB'' WHEN (lic.customer_sku LIKE ''9144528%'' OR lic.customer_sku LIKE ''MT-1170047%'') THEN ''Placemat'' WHEN lic.customer_sku IN (''2017001'',''2017002'') THEN ''Benefit Summary'' WHEN lic.customer_sku = ''3017001'' THEN ''All Savers-Plan Highlights'' WHEN lic.customer_sku = ''4017001'' THEN ''Benefits At A Glance'' WHEN lic.customer_sku = ''2017003'' THEN ''Summary of Benefits (SBC)'' WHEN (lic.customer_sku LIKE ''EI2090401%'' OR lic.customer_sku LIKE ''EI20295463%'') THEN ''OE Static Brochure'' WHEN (SELECT value FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productType'') = ''Static'' THEN (CASE WHEN (SELECT LOWER(value) FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') LIKE ''%envelope%'' THEN ''Envelope'' WHEN (SELECT LOWER(value) FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND NAME = ''productName'') LIKE ''%folder%'' THEN ''Folder'' ELSE ''Flyer'' END) END) ,(SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''p3Segment'') ,(CASE WHEN lic.customer_sku IN (''MT-1021355.0'',''MT-1021355.1'') THEN ''Medical'' WHEN (lic.customer_sku LIKE ''9201633%'' OR lic.customer_sku = ''MT-1021355.3'') THEN ''Financial Protection'' WHEN (lic.customer_sku LIKE ''9183516%'' OR lic.customer_sku = ''MT-1021355.2'') THEN RIGHT((SELECT value FROM ${schema}.line_item_component_custom_property WHERE line_item_component_id = lic.id AND (NAME = ''TEMPLATEProduct_Type'' OR NAME = ''TEMPLATE_Product_Type'')),6) END) ) UNION ALL ( SELECT (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) as ship_date ,''Kits Ordered'' AS product_segment ,NULL AS p3Segment ,NULL AS oecb_template ,SUM(li.quantity) AS quantity ,COUNT(DISTINCT li.id) AS orders ,0 AS people FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id WHERE po.program_id = 3 AND li.id IN ( SELECT line_item_id FROM ${schema}.line_item_component lic LEFT JOIN eni.sku_item esi ON esi.item_number = lic.customer_sku GROUP BY line_item_id ) AND YEAR(po.order_date) >= YEAR(CURDATE()) - 1 AND (SELECT status FROM ${schema}.order_status WHERE id = po.order_status_id) IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'') AND LOWER(li.customer_product_id) LIKE ''%kit%'' AND LOWER(li.customer_product_id) NOT LIKE ''%toolkit%'' AND (li.customer_product_id LIKE ''%Open Enrollment%'' OR li.customer_product_id LIKE ''%OE %'') GROUP BY (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) ) UNION ALL ( SELECT (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) as ship_date ,''Open Enrollment Queue Flag'' AS product_segment ,NULL AS p3Segment ,NULL AS oecb_template ,SUM(lic.quantity) AS quantity ,COUNT(DISTINCT po.id) AS orders ,0 AS people FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id LEFT JOIN eni.sku_item esi ON esi.item_number = lic.customer_sku WHERE po.program_id = 3 AND (li.customer_product_id LIKE ''%Open Enrollment%'' OR li.customer_product_id LIKE ''%OE %'') AND YEAR(po.order_date) >= YEAR(CURDATE()) - 1 AND (SELECT status FROM ${schema}.order_status WHERE id = po.order_status_id) IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'') AND ((SELECT order_id FROM ${schema}.note WHERE order_id = po.id AND LOWER(note) LIKE ''%team input successfully received%'' GROUP BY order_id)) > 0 GROUP BY (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) ) UNION ALL ( SELECT (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) as ship_date ,''Unique Users'' AS product_segment ,NULL AS p3Segment ,NULL AS oecb_template ,0 AS quantity ,0 AS orders ,COUNT(DISTINCT (SELECT value FROM ${schema}.order_property WHERE order_id = po.id AND name = ''userName'')) AS people FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id LEFT JOIN eni.sku_item esi ON esi.item_number = lic.customer_sku WHERE po.program_id = 3 AND (li.customer_product_id LIKE ''%Open Enrollment%'' OR li.customer_product_id LIKE ''%OE %'') AND YEAR(po.order_date) >= YEAR(CURDATE()) - 1 AND (SELECT status FROM ${schema}.order_status WHERE id = po.order_status_id) IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'') GROUP BY (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) ) UNION ALL ( SELECT (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) as ship_date ,''Unique Clients'' AS product_segment ,NULL AS p3Segment ,NULL AS oecb_template ,0 AS quantity ,0 AS orders ,COUNT(DISTINCT d.organization_name) AS people FROM ${schema}.platform_order po JOIN ${schema}.line_item li ON po.id = li.order_id JOIN ${schema}.destination d ON li.id = d.line_item_id JOIN ${schema}.line_item_component lic ON li.id = lic.line_item_id LEFT JOIN eni.sku_item esi ON esi.item_number = lic.customer_sku WHERE po.program_id = 3 AND (li.customer_product_id LIKE ''%Open Enrollment%'' OR li.customer_product_id LIKE ''%OE %'') AND YEAR(po.order_date) >= YEAR(CURDATE()) - 1 AND (SELECT status FROM ${schema}.order_status WHERE id = po.order_status_id) IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'') GROUP BY (SELECT DATE(modified_date) FROM ${schema}.order_status WHERE id = po.order_status_id AND status IN (''SENT_TO_PRINTER'',''SHIPPED'',''CLOSED'')) )' , `datasource` = '${schema}', `created_date` = NOW(), `modified_date` = NOW()
where report_id = (SELECT report_id from reports_details where report_name = 'OE VP DATA REPORT')
